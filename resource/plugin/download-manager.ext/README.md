# 下载管理器插件

这是一个为Tuboshu程序设计的下载管理插件，提供下载进度显示和历史下载记录功能。

## 功能特性

- 📥 **实时下载进度显示**
- 📊 **下载历史记录管理**
- 🖱️ **右键菜单快速下载**
- ⌨️ **快捷键支持**
- 🎨 **美观的界面设计**
- 📱 **响应式布局适配**
- 🌐 **网页环境支持**：兼容普通网页环境，无需Chrome扩展API
- 🔍 **智能拦截**：自动识别下载链接并接管下载流程
- 📋 **智能文件名识别**：从响应头自动提取正确文件名
- 🎯 **MIME类型检测**：根据文件类型自动添加扩展名
- 📊 **文件大小预检测**：下载前获取文件大小信息

### 支持的下载类型
- **压缩文件**: ZIP、RAR、7Z、TAR、GZ、BZ2等
- **安装程序**: EXE、MSI、DMG、PKG、DEB、RPM、APK等
- **办公文档**: PDF、DOC、DOCX、XLS、XLSX、PPT、PPTX、TXT、CSV等
- **音视频文件**: MP3、MP4、AVI、MKV、MOV、FLV、WMV、WAV等
- **图片文件**: JPG、JPEG、PNG、GIF、SVG、WEBP、ICO等
- **其他文件**: JSON、XML、TORRENT、BIN等
- **动态链接**: 包含download、attachment、getfile等关键词的链接
- **查询参数**: 包含file=、name=等参数的下载链接

## 安装方法

1. 将 `download-manager.ext` 文件夹复制到Tuboshu的插件目录：
   ```
   /d:/网页转应用/Tuboshu/resources/plugin/download-manager.ext/
   ```

2. 重启Tuboshu程序，插件将自动加载

## 使用方法

### 打开下载管理面板
- **悬浮按钮**: 点击右下角的绿色圆形悬浮按钮
- **面板位置**: 面板显示在悬浮按钮上方（底部150px），避免与记住密码插件重叠
- **右键菜单**: 或通过右键菜单中的选项

### 下载文件
1. **常规下载**: 浏览器正常下载会自动捕获
2. **右键下载**: 右键点击链接选择"下载此链接"
3. **拖拽下载**: 拖拽链接到面板中

### 管理下载
- **查看进度**: 在"进行中"标签页查看当前下载
- **历史记录**: 在"历史记录"标签页查看已完成的下载
- **重新下载**: 点击历史记录中的"重新下载"按钮
- **删除记录**: 点击历史记录中的"删除"按钮

## 界面说明

### 面板布局
- **顶部标题栏**: 显示插件名称和关闭按钮
- **标签页**: 切换"进行中"和"历史记录"
- **内容区域**: 显示下载列表

### 下载项信息
- 文件名
- 下载进度条
- 已下载大小/总大小
- 下载百分比
- 下载时间

## 技术细节

### 文件结构
```
download-manager.ext/
├── manifest.json      # 插件配置文件
├── downloadManager.js # 核心功能代码
├── downloadManager.css # 样式文件
├── test.html         # 测试页面
└── README.md         # 说明文档
```

### 权限要求
- `downloads`: 访问下载API
- `storage`: 本地存储下载历史
- `activeTab`: 获取当前活动标签页

### 数据存储
- 下载历史存储在浏览器的localStorage中
- 最多保存100条历史记录
- 数据格式：JSON字符串

## 开发说明

### 浏览器兼容性
- Chrome 88+
- Edge 88+
- 其他基于Chromium的浏览器

### 调试方法
1. 打开测试页面 `test.html`
2. 使用开发者工具查看控制台输出
3. 检查网络面板确认下载状态

### 自定义样式
可以通过修改 `downloadManager.css` 文件来自定义界面样式。

## 故障排除

### 常见问题

**Q: 下载管理面板不显示**
A: 检查是否已按 `Ctrl + Shift + D` 快捷键

**Q: 下载历史不保存**
A: 检查浏览器是否启用了localStorage

**Q: 右键菜单不出现**
A: 确保插件已正确安装并重启了Tuboshu

### 联系支持
如有问题，请检查插件目录权限或重新安装插件。

## 更新日志

### v1.0.0 (2024-01-01)
- 初始版本发布
- 基本下载管理功能
- 历史记录功能
- 右键菜单支持
- 快捷键支持